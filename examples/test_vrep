#!/usr/bin/env python

"""
This is a script for testing the example v-rep simulation
`arm_scene_example.ttt`. The purpose is to demonstrate how the simulation
works, not necessarily to test the vrepsim module.
"""

import time
import sys
import argparse

try:
    from pygesture import config
except ImportError:
    sys.path.insert(0, '..')
    from pygesture import config

from pygesture import control
from pygesture.simulation import vrepsim

parser = argparse.ArgumentParser(
    description="Runs through a pre-programmed sequence of movements.")
parser.add_argument('-c', '--config', default='config.py',
    help="Config file. Default is `config.py` (current directory).")
args = parser.parse_args()

cfg = config.Config(args.config)


vrepsim.set_path(cfg.vrep_path)
sim = vrepsim.VrepSimulation(cfg.vrep_port)
sim.start()
robot = vrepsim.IRB140Arm(sim.clientId)

def do(action, length):
    """
    Shorthand for doing an action for some time, then resting.
    """
    robot.do_action(action)
    time.sleep(length)
    robot.do_action('no-contraction')

do("forearm-supination", 1.4)
do("elbow-flexion", 0.5)
do("open-hand", 0.3)
do("wrist-flexion", 1.4)
do("elbow-flexion", 0.8)
do("closed-fist", 0.6)

time.sleep(1)

do("wrist-extension", 1.0)
do("elbow-extension", 1.8)
do("forearm-pronation", 1.6)
time.sleep(2)
do("forearm-supination", 1.6)
do("elbow-flexion", 2.0)
do("open-hand", 1.0)

time.sleep(1)

do("elbow-extension", 1.5)

sim.finish()
